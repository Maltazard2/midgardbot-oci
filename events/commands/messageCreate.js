const Similar = require('string-similarity');
const { Permissions } = require('discord.js');
const config = require('../../config.json');
var AsciiTable = require('ascii-table')

//& Modelos
const userModel = require('../../models/userSchema');
const blSchema = require('../../models/blSchema');
const autoSchema = require('../../models/autoSchema');
const turnoSchema = require('../../models/turnoSchema');
const serverSchema = require('../../models/serverSchema');
const xpclubSchema = require('../../models/xpclubSchema');
//& Modelos

module.exports = async (client, Discord, message) => {
    
    if(message.channel.type == "DM" ) return

    let buscarprefix, prefix
    try {

        buscarprefix = await serverSchema.findOne({idserver: message.guild.id})

        if(buscarprefix){

            prefix = buscarprefix.prefix

        } else {

            prefix = config.prefix

        }

    } catch (error) {

        console.log('Error al buscar Prefix en Servidor: '+ message.guild.id + ' - ' + error)
        prefix = config.prefix

    }
    
    let sv = client.guilds.cache.get('851924635930329098')
    let channel
    let idcanal = message.channel.id
    let logschannel = client.channels.cache.get('965156885558878319')

    const em = new Discord.MessageEmbed()
    .setThumbnail(message.guild.iconURL() ? message.guild.iconURL({ dynamic: true }) : client.user.avatarURL({ dynamic: true }) )
    .setAuthor({ name: 'MaltaBot', iconURL: client.user.avatarURL({ dynamic: true }) })
    .setTitle('üì¢ | Mensaje Enviado')
    .addField('Canal: ', `<a:flech:931432469935312937> <#${idcanal}>`)
    .addField('Autor: ', `<a:flech:931432469935312937> ${message.author}`)
    .addField('Mensaje: ', message.content ? message.content : 'Ning√∫n mensaje registrado')
    .setColor('RANDOM')
    .setTimestamp(new Date())
    .setFooter({ text: `Id: ${message.author.id}`, iconURL: message.author.displayAvatarURL({ dynamic: true }) })
  
    if(idcanal === '880290686107275304')
    {
        channel = sv.channels.cache.get('880267684950999050')
  
        if(message.content.length >= 1000) return channel.send('Mensaje demasiado largo, enviado en alto cargo por: '+message.author).catch((e) => console.log('Error al enviar mensaje: '+e))
  
        channel.send({ embeds: [em] }).catch((e) => console.log('Error al enviar mensaje: '+e))
    
    } else if(idcanal === '880292291443556383')
    {
        channel = sv.channels.cache.get('880280405993996339')
    
        if(message.content.length >= 1000) return channel.send('Mensaje demasiado largo, enviado en √©lite por: '+message.author).catch((e) => console.log('Error al enviar mensaje: '+e))
        
        channel.send({ embeds: [em] }).catch((e) => console.log('Error al enviar mensaje: '+e))
    
    } else if(idcanal === '840161683732693033')
    {
        channel = sv.channels.cache.get('880280308732272640')
    
        if(message.content.length >= 1000) return channel.send('Mensaje demasiado largo, enviado en staff por: '+message.author).catch((e) => console.log('Error al enviar mensaje: '+e))
    
        channel.send({ embeds: [em] }).catch((e) => console.log('Error al enviar mensaje: '+e))
    
    } else if(idcanal === '923716261542781018')
    {
        channel = sv.channels.cache.get('933917185695428628')
    
        if(message.content.length >= 1000) return channel.send('Mensaje demasiado largo, enviado en supervisores por: '+message.author).catch((e) => console.log('Error al enviar mensaje: '+e))
    
        channel.send({ embeds: [em] }).catch((e) => console.log('Error al enviar mensaje: '+e))
  
    } else if(idcanal === '909722451745837106')
    {
        channel = sv.channels.cache.get('880280346208395305')
    
        if(message.content.length >= 1000) return channel.send('Mensaje demasiado largo, enviado en admin por: '+message.author).catch((e) => console.log('Error al enviar mensaje: '+e))
    
        channel.send({ embeds: [em] }).catch((e) => console.log('Error al enviar mensaje: '+e))
    
    } else if(idcanal === '870195067338506271')
    {
        channel = sv.channels.cache.get('880280535304372234')
    
        if(message.content.length >= 1000) return channel.send('Mensaje demasiado largo, enviado en chat general por: '+message.author).catch((e) => console.log('Error al enviar mensaje: '+e))
        
        channel.send({ embeds: [em] }).catch((e) => console.log('Error al enviar mensaje: '+e))
    
    } else
    {
        var canalrestringidos = [
          '880280265216389140','880267684950999050',
          '880280405993996339', '880280308732272640',
          '880280346208395305', '880280369126051861',
          '880280535304372234', '880280557051858974',
          '933903109305028688', '933917185695428628'
        ]
  
        if(!canalrestringidos.some(id => idcanal == id))
        {
            channel = sv.channels.cache.get('880280265216389140')
      
            if(message.content.length >= 1000) return channel.send(`Mensaje demasiado largo, enviado en <#${idcanal}> por: `+message.author).catch((e) => console.log('Error al enviar mensaje: '+e))
      
            em.addField('Servidor: ', `<a:flech:931432469935312937> ${message.guild.name}`)
      
            channel.send({ embeds: [em] }).catch((e) => console.log('Error al enviar mensaje: '+e))
  
        } else {
          
            return
            
        }
    
    }
    
    if (message.author.bot) return;


    //& SECCI√ìN DE TURNOS - STAFF

    let userTurno

    if(idcanal === '870195067338506271'){

        try {

            userTurno = await turnoSchema.findOne({idusuario: message.author.id})

            if(userTurno){

                console.log('========================= ACTUALIZACI√ìN DE STAFF DE TURNO =========================');
        
                let update = await turnoSchema.findOneAndUpdate({idusuario: message.author.id},
                    {

                        mensajes: userTurno.mensajes + 1

                    })

                update.save()
   
                console.log('Mensajes de Staff de Turno Actualizado ===> Id: '+ message.author.id + ' Username: ' + message.author.username)
   
                console.log('========================= ACTUALIZACI√ìN DE STAFF DE TURNO =========================');
   
            }

        } catch (error) {

            console.log('Error al Registrar Mensajes de Staff de Turno: '+ error)
      
        }

    }

    //& SECCI√ìN DE TURNOS - STAFF

    
    //* SECCI√ìN DE AUTORESPUESTAS

    try {
        
        let autorespuesta = await autoSchema.find({ idserver: message.guild.id, trigger: message.content.toLowerCase() }).sort({ idcc: -1 })
        let datos = []

        if(autorespuesta){

            for(let ls of autorespuesta){

                datos.push(ls.response)

            }

            if(datos.length > 0){
                
                message.channel.send(datos[Math.floor(Math.random()*datos.length)]).catch((e) => console.log('Error al enviar autorespuesta: '+e))

            }

        }
        
    } catch (error) {
        
        console.log('Error al obtener autorespuestas: ' + error)
    }

    //* SECCI√ìN DE AUTORESPUESTAS


    //? SECCI√ìN DE AUTORESPUESTAS - MIDGARD

    var hola = [

        'Cara de bola <:niasacandolengua:948756194917507102>',
        'Ya lleg√≥ este wey <a:StichFudioso:911090819174383616>', 
        'Te pico la cola <a:run:880304386826465300>', 
        'Hola lindura <a:Gatitoalv:900075164295905371>', 
        'Que onda <:PolloPro:911096064545816606>',
        'Ya era hora de que llegaras <:pocoyoMolesto:894367131125284924>', 
        '¬øQu√© tal tu d√≠a?',
        'Hola mi amor <:BlushedCat:920964717864964116>',
        'Hola ' + message.author.username + ', c√≥mo va tu d√≠a?'
      
    ]

    if (message.content.toLowerCase() === 'hola' || message.content.toLowerCase() === 'holas'){
          
        if(message.guild.id !== '777620055344545842') return
        message.channel.send(hola[Math.floor(Math.random()*hola.length)]).catch((e) => console.log('Error al enviar mensaje: '+e))
  
    }

    var ola = [

        '<a:Ohsi:887055459612241981> Ola lindo',
        'Se dice Hola <:luser:920143138696347678>',
        'Ayoooolaaa <:abby:880300168514252811>', 
        'Que onda <:PolloPro:911096064545816606>', 
        'Cara de bola',
        'Te pico la cola <a:run:880304386826465300>', 
        'Oliiii', 
        'To piola?',
        'Llegaste a tiempo para besarnos <:Awebo_a_simpiar:901600161875259452>', 
        'Ola mailov <a:holaaa:934823319331569664>',
        'Hola, con H de Huevos los que le faltaron a tu ex <a:ayajasisi:945203356140441650>',
        'del mar üåä',
      
    ]

    if (message.content.toLowerCase() === 'ola' || message.content.toLowerCase() === 'olas'){
  
        if(message.guild.id !== '777620055344545842') return
        message.channel.send(ola[Math.floor(Math.random()*ola.length)]).catch((e) => console.log('Error al enviar mensaje: '+e))
  
    }

    var buendia = [

        'Buen d√≠a joven <:Para_ti_tambien:897241426021208065>',
        'Pase, pase, est√° en su casa <a:ayajasisi:890684634369777724>',
        '¬øC√≥mo te va?',
        'Igualmente chulada',
        '<:QueFachero:915845462127435816> ¬øTodo bien?',
        '<:Me_ataca_aiuda:897241560159236116> Dej√≥ de ser un buen d√≠a desde que ca√≠ste en sus mentiras',
        'Tardes ya <:zerotwo_why:880315297104547870>',
        'Buen d√≠a precios@ ‚ù§',
      
    ]

    if (message.content.toLowerCase() === 'buen d√≠a' || message.content.toLowerCase() === 'buen dia'){
          
        if(message.guild.id !== '777620055344545842') return
        message.channel.send(buendia[Math.floor(Math.random()*buendia.length)]).catch((e) => console.log('Error al enviar mensaje: '+e))
          
    }

    var buenosdias = [

        '<:GatoGuatafac:911089127129227314> Solo d√≠as', 
        '¬°Cu√°nta amabilidad! <:yamique:924441571355684935>', 
        'Eran buenos hasta que llegaste <a:zbailabaila:890772645342236732>', 
        'Hasta que despiertas <a:ayajasisi:890684634369777724>',
        'Apenas? <:Y_moriste:897241205111418920>',
        '¬øC√≥mo amaneciste?',
        'Tardes ya',
        'Buenos d√≠as precios@ ‚ù§',
      
    ]

    if (message.content.toLowerCase() === 'buenos d√≠as' || message.content.toLowerCase() === 'buenos dias'){
          
        if(message.guild.id !== '777620055344545842') return
        message.channel.send(buenosdias[Math.floor(Math.random()*buendia.length)]).catch((e) => console.log('Error al enviar mensaje: '+e))
      
    }

    var buenastardes = [

        'Solo tardes <:FLORK_clorox:956314038227324968> porque buenas sus mentiras', 
        '**Ya llegooooo!!!**',
        'Que bueno que llegas, apenas empieza el chisme <:bombon:925327781104082974>', 
        '¬øQu√© va a llevar joven?',
        'Tardes, porque buenas las que te cargas <a:Nalgada:880315282101526598>', 
        'Para ti tambi√©n <a:Gatitoalv:900075164295905371>',
        'Buenas tardes precios@ ‚ù§',
      
    ]

    if (message.content.toLowerCase() === 'buenas tardes'){
          
        if(message.guild.id !== '777620055344545842') return
        message.channel.send(buenastardes[Math.floor(Math.random()*buenastardes.length)]).catch((e) => console.log('Error al enviar mensaje: '+e))
          
    }

    var buenasnoches = [

        '<:ChayanneFlor:906775267492646924> Descansa bb',
        'Hasta ma√±ana bb', 
        'Tan temprano te vas? <:AAAAa:882776373201088512>', 
        'No te vayas <:668957583889137664:882761465101180960>', 
        'Sue√±as conmigo <a:sabroso:932177227792146433>', 
        'Solo noches <a:PepeDuckToy:925294858745307136>',  
        'Noches, porque buenas sus intenciones contigo <:Para_ti_tambien:897241426021208065>',
        'Buenas noches precios@ ‚ù§',
      
    ]

    if (message.content.toLowerCase() === 'buenas noches'){
         
        if(message.guild.id !== '777620055344545842') return
        message.channel.send(buenasnoches[Math.floor(Math.random()*buenasnoches.length)]).catch((e) => console.log('Error al enviar mensaje: '+e))
          
    }
    
    var buenas = [

        'Las que te cargas mi amor <a:sabroso:932177227792146433>', 
        'Hoy amanecimooos <a:Dance:883031053772681216>', 
        'Ya te las viste? <:zerotwo_why:880315297104547870>', 
        'Sus mentiras <:ayno:925298581903118376>',  
        'Hola buenaaaas <:bobesponja:935069041167564820>', 
        'Las tuyas <a:NalgasdeAna:887498069569044541>',
        'Las tienes <a:perreom:930719549131735040>',
      
    ]
    
    if (message.content.toLowerCase() === 'buenas' || message.content.toLowerCase() === 'wenas'){
        
        if(message.guild.id !== '777620055344545842') return
        message.channel.send(buenas[Math.floor(Math.random()*buenas.length)]).catch((e) => console.log('Error al enviar mensaje: '+e))
  
    }

    if (message.content.toLowerCase() === 'wlc' || message.content.toLowerCase() === 'welcome' || message.content.toLowerCase() === 'bienvenido' || message.content.toLowerCase() === 'bienvenida' || message.content.toLowerCase() === 'bienvenid@' || message.content.toLowerCase() === 'bienvenidos' || message.content.toLowerCase() === 'bienvenid@s' || message.content.toLowerCase() === 'bienvenidas'){
          
        if(message.guild.id !== '777620055344545842') return
        message.react(`<a:pasito:877116925291946094>`).catch((e) => console.log('Error al reaccionar: '+e))
        message.react(`<a:cerveza:880635824021065738>`).catch((e) => console.log('Error al reaccionar: '+e))
          
    }

    //? SECCI√ìN DE AUTORESPUESTAS - MIDGARD

  
    let img = '753435606410985573'
  
    const bSi = new Discord.MessageButton()
        .setCustomId("accept")
        .setLabel("SI")
        .setStyle("SUCCESS")
  
    const bNo = new Discord.MessageButton()
        .setCustomId("deny")
        .setLabel("NO")
        .setStyle("DANGER")
    
    if (message.content.toLowerCase() === 'malta' || message.content.toLowerCase() === 'maltazar' || message.content.toLowerCase() === 'maltazard')
    {
    
        message.channel.send({

            content: message.author.toString() + "¬øDeseas contactar a Malta?",
            components: [
  
                new Discord.MessageActionRow().addComponents([bSi,bNo])

            ]

        }).then(async m => {
            
            let filter = int => int.isButton() && int.user.id == message.author.id 
             
            const collector = m.createMessageComponentCollector({ filter, max: 1, maxUsers: 1, maxComponents: 1, time: 60000 });
            
            collector.on("collect", async int => {
              
                int.deferUpdate();
                
                if (int.customId === "accept") {
                  
                    m.edit({
                  
                        content: `Contactando a mi creador... <a:cargando:887482093481902101>`,
                        components: []

                    }).then(async (m) => {

                        message.channel.sendTyping()
                        
                        setTimeout(async () => {

                            m.delete()

                            await message.channel.send({

                                content: `<@${img}> Te buscan por aqu√≠ <:yonofui:931433119859503194>`,
                                components: []
        
                            })

                        }, 5000)

                    })
         
                } else if (int.customId === "deny") {
                  
                    m.edit({
                  
                        content: "Gracias, si necesitas algo, no dudes en contactarme. <:tierno:931433334960160799>",
                        components: []

                    });
                
                }
            
            });
        
            collector.on("end", (collected, reason) => {
              
                if(collected.size < 1 || reason === 'time') return m.edit({
                
                    content: "**¬°No confirmaste a tiempo!** <:enojado:931434000751394867>",
                    components: []
              
                });

                console.log('Raz√≥n del t√©rmino de colecci√≥n de Malta: '+reason)
                
            });
              
        });
    }
    
    /*let reven = new RegExp(`^<@!?${'710588969557164113'}>( |)$`);
    
    if (message.content.match(reven))
    {
    
        message.channel.send(`ùë¨ùíç ùíñÃÅùíçùíïùíäùíéùíê ùíáùíäùíÜùíç ùííùíñùíÜ ùííùíñùíÜùíÖùíÇ ùíÜùíè ùíÜùíîùíïùíÜ ùíéùíñùíèùíÖùíê <a:FuegoRojo:882761255381790750>`)
    
    }*/
    
    /*let mencionado = message.guild.members.resolve(message.mentions.users.first())

    if(mencionado)
    {

        if (mencionado.id === '753435606410985573'){
        
            message.channel.send(`¬øQu√© necesitas de mi due√±o? <a:ositovino:880306728867078165>`)
    
        } else if (mencionado.id === '683501310527668228'){

            message.channel.send('Tan al pendiente est√°s que tienes que hacerme ping? <a:ayajasisi:890684634369777724>')
            
        }

    }*/

    let malta = new RegExp(`^<@!?${'753435606410985573'}>( |)$`)

    if (message.content.match(malta))
    {
    
        message.channel.send(`¬øQu√© necesitas de mi due√±o? <a:ositovino:880306728867078165>`).catch((e) => console.log('Error al enviar mensaje: '+e))
    
    }

    let insp = new RegExp(`^<@!?${'683501310527668228'}>( |)$`)

    if (message.content.match(insp))
    {
    
        var i = [

            '¬øQu√© necesitas de la Inspectora? <a:ayajasisi:890684634369777724> Por ahora solo inspecciones al dm <:X_pw:887055706509959178>‚Ä¶. Ya sabes, tu Inspectora de confianza al servicio de la comunidad <a:ositovino:880306728867078165>',
            '<:simp_:915076757802086401>',

        ]

        message.channel.send(i[Math.floor(Math.random()*i.length)]).catch((e) => console.log('Error al enviar mensaje: '+e))
    
    }
  
    let ian = new RegExp(`^<@!?${'603344396351438889'}>( |)$`);
    
    if (message.content.match(ian))
    {
        
        if(message.guild.id !== '777620055344545842') return 
        message.channel.send(`<a:megaphone:932192877449191424> Alo? Tierra llamando al **argentino con m√°s flow** <a:darkcrown2:886466286773739530>, Ian en camino beb√© <a:bmirusboyrunfast:880411644893724672>`).catch((e) => console.log('Error al enviar mensaje: '+e))
    
    }
  
    let ana = new RegExp(`^<@!?${'883633609498570762'}>( |)$`);
    
    if (message.content.match(ana))
    {
        
        if(message.guild.id !== '777620055344545842') return    
        message.channel.send(`<:emoji_233:890722279074451506> D√≠as,tardes,noches,madrugadas <:mmsi:925934342016995379> porque Buena est√° la persona que me acaba de mencionar <a:Zuii:890684724673150996> <a:Ytodomedavuelta:890721775699259422>`).catch((e) => console.log('Error al enviar mensaje: '+e))
    
    }
  
    let nia = new RegExp(`^<@!?${'743960732542042203'}>( |)$`);
    
    if (message.content.match(nia))
    {
        
        if(message.guild.id !== '777620055344545842') return  
        message.channel.send(`¬ø¬°ùë∏ùíñùíÜ ùíèùíÜùíÑùíÜùíîùíäùíÖùíÇùíÖ ùíÖùíÜ ùíëùíäùíèùíàùíÜùíÇùíÇùíÇùíÇùíì!? <:gatoNojao:930403164266565642>`).catch((e) => console.log('Error al enviar mensaje: '+e))
    
    }
    
    if (message.content.toLowerCase() === 'piropo')
    {
    
        var piropo = [
            'El amor ser√° ciego, pero hay que ver lo mucho que alegras la vista.','Con esos ojos mir√°ndome, ya no me hace falta la luz del sol.',
            'Por la luna dar√≠a un beso, dar√≠a todo por el sol, pero por la luz de tu mirada, doy mi vida y coraz√≥n.','Si yo fuera un avi√≥n y t√∫ un aeropuerto, me la pasar√≠a aterrizando por tu hermoso cuerpo.',
            'Me gusta el caf√©, pero prefiero tener-t√©.','No eres google, pero tienes todo lo que yo busco.',
            'Mis ganas de ti no se quitan, se acumulan.','Cuando te multen por exceso de belleza, yo pagar√© tu fianza.',
            'Si cada gota de agua sobre tu cuerpo es un beso, entonces quiero convertirme en aguacero.','Est√°s como para invitarte a dormir, y no dormir.',
            'Si tu cuerpo fuera c√°rcel y tus brazos cadenas, ese ser√≠a el lugar perfecto para cumplir condena.','Qu√© bonitos ojos tienes, tan redondos como el sol, se parecen a los ceros que me pone el profesor.',
            'Eres como la chancha de mi mam√°, te veo venir y se me acelera el coraz√≥n.','Si lo bonito fuera pecado, t√∫ no tendr√≠as el perd√≥n de Dios.',
            'Ni en clase de matem√°ticas me perd√≠a tanto como en tu mirada.','Quisiera olvidarte, pero sin el olvi.',
            'Se te ha ca√≠do el papel que te envuelve, bomb√≥n.','Me gustas m√°s que dormir hasta tarde.',
            '¬øMe haces un favor? Sal de mis sue√±os y entra en mi realidad.','Ni en el mejor libro de recetas se encuentra semejante bomb√≥n.',
            '¬øEst√°n lloviendo estrellas o solo t√∫ ca√≠ste del cielo?','Mi amor, qui√©n fuera cemento para sostener ese monumento.',
            'Si tuviera que regalarte algo, te regalar√≠a un espejo, porque despu√©s de este mundo, lo m√°s bonito es tu reflejo.','No me gusta atarme, pero por ti, yo me encadeno.',
            'Eres tan dulce que solo con mirarte engordo.','Si los besos transmiten g√©rmenes, yo contigo s√≠ empiezo una epidemia.',
            '¬øDe que panader√≠a te escapaste bizcochito?','Y Dios dijo: ¬´H√°gase lo m√°s hermoso del universo¬ª y naci√≥ la hermosura que est√° leyendo esto.',
            'Quien fuera mago para echarte un polvo y desaparecer.','Quisiera ser hamburguesa y que me llenes de mayonesa.',
            'Tienes la sonrisa que quiero darle a mis hijos.','Dios te guarde y me d√© la llave.',
            'Ning√∫n ¬´Escribiendo‚Ä¶¬ª me pone tan feliz como el tuyo.','T√∫ eres Coca Cola y yo un hielito, ¬°no me toques que me derrito!',
            '¬øTienes algo que hacer? Podemos hacer turismo por mi cuarto.','Eres como el chocolate, te me antojas a cada ratito.',
            'Perd√≠ mi n√∫mero de tel√©fono, ¬øme das el tuyo?','Tu amor me ha contagiado, como un virus imposible de curar.',
            'Acabo de perder tres besos bajo tu camiseta, ¬øme ayudas a buscarlos?','Que bonito ser√≠a despertarme a mitad de noche y verte ah√≠, a mi lado.',
            'Si solo con ver tu nombre me haces suspirar, imag√≠nate cuando te veo.','Quisiera ser pensamiento y estar dentro de ti, y as√≠ saber el momento en que te acuerdas de mi.',
            'Te quiero, pero no s√© en qu√© posici√≥n, ¬øme ayudas a elegir?','¬øCrees en el amor a primera vista o tengo que darme otra vuelta y volver a pasar?',
            '¬øQui√©n te crees para gustarme tanto?','La distancia y el tiempo no saben la falta que le haces a mi coraz√≥n.',
            'Eres la canci√≥n que hace sonar mi guitarra.','No pretendo decir algo bonito, lo que te digo es muy sincero: el cari√±o que siento es infinito y mi amor por ti es verdadero.',
            'Si ser bella fuese delito, te condenar√≠an de por vida.','Si Crist√≥bal Col√≥n te viese, dir√≠a; ¬´Santa Mar√≠a, pero qu√© Pinta tiene esa Ni√±a¬ª.',
            'Quisiera ser hormiguita para subir por tu balc√≥n y decirte al o√≠do; guapa, bonita, bomb√≥n.','C√≥mo me gustar√≠a ser tu secador de pelo‚Ä¶ para que todos los d√≠as me agarres del mango.',
            'A lo mejor mi hogar no es un palacio, pero me gustar√≠a que t√∫ fueras mi princesa.','La belleza de una rosa no tiene comparaci√≥n con la dulzura de tu rostros y la hermosura de tu coraz√≥n.',
            'Aprovecha que estoy en rebajas guapa y te dejo dos besos por el precio de uno.','¬øEst√°s preparada para subir a la Luna? Porque tengo el cohete preparado.',
            'Si un d√≠a olvido lo hermosa que eres, ay√∫dame a recordarlo con la luz de tu sonrisa y el sabor de tus labios.','T√∫ con tantas curvas y yo sin frenos.',
            'No es el whisky ni la cerveza, eres t√∫ quien se me ha subido a la cabeza.','Me encanta la solter√≠a, pero por ti me lo pensar√≠a.'
        ]
    
        let rpiropo = piropo[Math.floor(Math.random()*piropo.length)]
    
        const embed = new Discord.MessageEmbed()
        .setColor('RANDOM')
        .setDescription(rpiropo)

        if(message.guild.id !== '777620055344545842') return
        message.channel.send({ embeds: [embed] }).catch((e) => console.log('Error al enviar mensaje: '+e))
  
    }
    
    
    if (message.content.toLowerCase() === 'chiste')
    {
    
        var chiste = [
            '- ¬øTienes WiFi?\n- S√≠\n- ¬øY cu√°l es la clave?\n- Tener dinero y pagarlo.',
            'En una entrevista de trabajo:\n- ¬øNivel de ingl√©s?\n- Alto\n- Bien. Traduzca *mirar*.\n- Look.\n- Perfecto. √öselo en una frase.\n- *Luke*, yo soy tu padre.\n- Contratado.',
            '¬øCu√°l es el caf√© m√°s peligroso del mundo?\nEl ex-preso',
            '- Mam√°, mam√°, los spaghetti se est√°n pegando.\n- D√©jalos que se maten',
            '- Soy Rosa.\n- Ah, perd√≥name, es que soy dalt√≥nico.',
            '- Oye, ¬øcu√°l es tu plato favorito y por qu√©?\n- Pues el hondo, porque cabe m√°s comida‚Ä¶',
            '¬øQu√© pasa si tiras un pato al agua?.\nNada.',
            '- Ayer llam√© a la polic√≠a porque unos ladrones robaron en mi casa y se llevaron hasta los vasos.\n- ¬øY los detuvo?\n-S√≠, s√≠, los de tubo tambi√©n.',
            '¬øC√≥mo te llamas?\n- Lancelot.\n- Pues atr√°palot‚Ä¶',
            '- Pap√°, ¬øqu√© est√° m√°s lejos, C√≥rdoba o la Luna?.\n - Pero vamos a ver, ¬øt√∫ ves desde aqu√≠ C√≥rdoba?',
            'Mi ordenador me gana al ajedrez, pero yo le gano boxeando.',
            'General: Soldado, ice la bandera\n Soldado: Pues le qued√≥ muy bonita',
            '- A las 10 te pito y bajas.\n- ¬øTe has comprado un coche?\n- No, un pito.',
            '¬øCu√°l es el coche favorito de un fot√≥grafo?\nEl Ford Focus',
            'Oye, ¬øcu√°nto te cost√≥ esa terapia que hiciste para dejar de pensar en comida todo el rato?\n- Pimientos euros.',
            'Pero mira que te he dicho diez mil millones de veces que no exageres‚Ä¶',
            '¬øTe gusta el rock progresivo?\n- Cada vez m√°s.',
            '- Buf, me ha ca√≠do mal el estofado.\n- ¬°Pues no le hables, hombre!',
            '- A m√≠ me gustar√≠a vivir en una isla desierta.\n- A m√≠ tambi√©n.',
            'Errar es humano, pero lo es todav√≠a m√°s echarle las culpas a otro.',
            'Pues s√≠, el viaje a la India me cambi√≥ la vida.\n- ¬øM√°s langosta, se√±or?\n- Pero ponle curry.',
            'Suena el tel√©fono:\n- ¬øHola?\n- Hola.\n- ¬øEs aqu√≠ donde lavan ropa?\n- No.\n- Pues s√≠ que son guarros.',
            'Llaman a la puerta y es un t√©cnico del ayuntamiento.\n- Perdone, pero vamos a proceder al derribo del edificio contiguo.\n- ¬øConmigo?'
        ]
    
        let rchiste = chiste[Math.floor(Math.random()*chiste.length)]
    
        const embed = new Discord.MessageEmbed()
        .setColor('RANDOM')
        .setDescription(rchiste)

        if(message.guild.id !== '777620055344545842') return
        message.channel.send({ embeds: [embed] }).catch((e) => console.log('Error al enviar mensaje: '+e))
    
    }

    //? REMINDERS NEKOTINA

    // var canal =  [

    //     '870195067338506271',
    //     '880336724662825040',
    //     '881432157602611230',
    //     '917258698202677258',
    //     '880260537659850792',
    //     '935391521480527922',
    //     '880295833252265994',
    //     '848755526347128872',
    //     '880317466557952000',
    //     '840421355736530985',
    //     '882258445334626344',
    //     '882258853767577621',
    //     '887820617632583772',
    //     '896865094250684466',
    //     '935454536678649856',
    //     '880319348496039946'

    // ]

    var canal = [
        
        '912790956057710623'
        
    ]

    if (message.content.toLowerCase() === 'mine'){

        if(!canal.some(id => message.channel.id === id)) return

        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('https://c.tenor.com/AMnlFqJnKhwAAAAd/se-va-a-minar-minar.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Es hora de ir a la mina<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:flech:931432469935312937> Te recordar√© dentro de `3 minutos` usar el comando `mine`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 180000);

    }

    if (message.content.toLowerCase() === 'hmine'){

        if(!canal.some(id => message.channel.id === id)) return

        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('https://c.tenor.com/AMnlFqJnKhwAAAAd/se-va-a-minar-minar.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Es hora de ir a la mina, antes que se acabe el Haste<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:flech:931432469935312937> Te recordar√© dentro de `1 minuto y 20 segundos` usar el comando `mine`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 80000);

    }

    if (message.content.toLowerCase() === 'fish'){

        if(!canal.some(id => message.channel.id === id)) return
        
        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('https://www.gifsanimados.org/data/media/157/pesca-imagen-animada-0057.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Es hora de ir a la pesca<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:flech:931432469935312937> Te recordar√© dentro de `3 minutos` usar el comando `fish`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 180000);

    }

    if (message.content.toLowerCase() === 'hfish'){

        if(!canal.some(id => message.channel.id === id)) return
        
        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('https://www.gifsanimados.org/data/media/157/pesca-imagen-animada-0057.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Es hora de ir a la pesca, antes que se acabe el Haste<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:flech:931432469935312937> Te recordar√© dentro de `1 minuto y 20 segundos` usar el comando `fish`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 80000);

    }

    if (message.content.toLowerCase() === 'pet'){

        if(!canal.some(id => message.channel.id === id)) return
        
        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('https://c.tenor.com/AMnlFqJnKhwAAAAd/se-va-a-minar-minar.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Tu mascota ya est√° lista para regresar<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:Dancing_Duck:930402083625111613> Le deseo un buen viaje a tu `pet` y que te traiga algo muy bueno!\n<a:flech:931432469935312937> Te recordar√© en `30 minutos`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 1800000);

    }

    if (message.content.toLowerCase() === 'hpet'){

        if(!canal.some(id => message.channel.id === id)) return
        
        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('https://c.tenor.com/AMnlFqJnKhwAAAAd/se-va-a-minar-minar.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Tu mascota ya est√° lista para regresar<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:Dancing_Duck:930402083625111613> Le deseo un buen viaje a tu `pet` y que te traiga algo muy bueno, antes que se acabe el Haste!\n<a:flech:931432469935312937> Te recordar√© en `15 minutos`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 900000);

    }

    if (message.content.toLowerCase() === 'work'){

        if(!canal.some(id => message.channel.id === id)) return
        
        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('https://i.giphy.com/media/7E8tiGcPf1G78dMXRf/giphy.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Es hora de ir a trabajar<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:flech:931432469935312937> Te recordar√© dentro de `1 hora` usar el comando `work`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 3600000);

    }

    if (message.content.toLowerCase() === 'hwork'){

        if(!canal.some(id => message.channel.id === id)) return
        
        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('https://i.giphy.com/media/7E8tiGcPf1G78dMXRf/giphy.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Es hora de ir a trabajar, antes que se acabe el Haste<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:flech:931432469935312937> Te recordar√© dentro de `30 minutos` usar el comando `work`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 1800000);

    }

    if (message.content.toLowerCase() === 'zodiac'){

        if(!canal.some(id => message.channel.id === id)) return
        
        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('https://i.giphy.com/media/7E8tiGcPf1G78dMXRf/giphy.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Es hora de recoger lo que tu zodiac recolect√≥ para ti<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:flech:931432469935312937> Te recordar√© dentro de `1 hora` usar el comando `work`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 3600000);

    }

    if (message.content.toLowerCase() === 'wf'){

        if(!canal.some(id => message.channel.id === id)) return
        
        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('https://c.tenor.com/rvnbqOmEEXIAAAAC/cute-loli-waifu.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Ya puedes volver a votar por tu waifu favorita<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:flech:931432469935312937> Te recordar√© dentro de `6 horas` volver a votar por tu `waifu`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 21600000);

    }

    if (message.content.toLowerCase() === 'hb'){

        if(!canal.some(id => message.channel.id === id)) return
        
        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('https://i.gifer.com/8WlW.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Ya puedes volver a votar por tu husbando favorito<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:flech:931432469935312937> Te recordar√© dentro de `6 horas` volver a votar por tu `husbando`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 21600000);

    }

    if (message.content.toLowerCase() === 'rep'){

        if(!canal.some(id => message.channel.id === id)) return
        
        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('http://3.bp.blogspot.com/-gU7DGjh_SSQ/VgMc-zPIeKI/AAAAAAAA2R8/ZjnSgT77tZw/s1600/hotel-27.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Ya puedes volver a dar rep<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:flech:931432469935312937> Te recordar√© dentro de `6 horas` usar el comando `rep`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 21600000);

    }

    if (message.content.toLowerCase() === 'farm'){

        if(!canal.some(id => message.channel.id === id)) return
        
        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('http://olegif.com/bin/gifs/00/49/46.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Es hora de farmear<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:flech:931432469935312937> Te recordar√© dentro de `6 minutos` usar los comandos de farmeo: `mine` y `fish`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 360000);

    }

    if (message.content.toLowerCase() === 'hfarm'){

        if(!canal.some(id => message.channel.id === id)) return
        
        function reminder() {
    
            message.reply({embeds: [
    
              new Discord.MessageEmbed()
              .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL() })
              .setThumbnail('http://olegif.com/bin/gifs/00/49/46.gif')
              .setColor('RANDOM')
              .setDescription('<a:flech:931432469935312937> | Es hora de farmear, antes que se acabe el haste<a:exclama2:880930071731392512>')
        
            ]})
    
        }

        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: 'Nekotina', iconURL: client.user.avatarURL({ dynamic: true }) })
        .setTitle('<a:tiempogif:931434689481285662> Recordatorio activado para: *`'+message.author.username+'`*')
        .setThumbnail(message.author.displayAvatarURL({ dynamic: true }))
        .setDescription('<a:flech:931432469935312937> Te recordar√© dentro de `3 minutos` usar los comandos de farmeo: `mine` y `fish`.')
        .setColor('RANDOM')
        .setTimestamp(new Date())
        .setFooter({ text: message.guild.name, iconURL: message.guild.iconURL({ dynamic: true }) })
        message.channel.send({ embeds: [embed] })

        setTimeout(reminder, 180000);

    }


    //& COMANDO ALIANZAS BABEL

    if(message.channel.id === '961001644294824017'){

        if(message.content.includes('https://discord.gg/')){

            try {

                const invite = await client.fetchInvite(message.content)
    
                const embed = new Discord.MessageEmbed()
                .setAuthor({ name: message.author.tag, iconURL: message.author.displayAvatarURL({ dynamic: true}) })
                .setColor('RANDOM')
                .setTimestamp(new Date())
                .setFooter({ text: '!capply Midgard', iconURL: 'https://i.imgur.com/aaky0WD.png' })
    
                if(invite.guild){

                    if(invite.guild.bannerURL()){

                        embed.setThumbnail(invite.guild.iconURL() ? invite.guild.iconURL({ dynamic: true, size: 4096 }).replace('webp','png') : message.author.displayAvatarURL({ dynamic: true, size: 4096 }).replace('webp','png') )
                        embed.setImage(invite.guild.bannerURL({ size: 2048, format: 'gif' }))

                    }else {

                        embed.setThumbnail(message.author.displayAvatarURL({ dynamic: true, size: 4096 }).replace('webp','png'))
                        embed.setImage(invite.guild.iconURL({ dynamic: true, size: 4096 }))

                    }
    
                    embed.setTitle('<:babel_Midgard:978300970868035604> __ùë©ùíÇùíÉùíÜùíç ùë®ùíÉùíäùíÜùíìùíïùíê ùíÜùíè:__ ')
                    embed.setDescription('\n\n‚óû‚îà‚îà‚îà‚ãÜ‚îà‚îà‚ä∞‚ú©‚ä±‚îà‚îà‚ãÜ‚îà‚îà‚îà‚óü\n\n     ‚òÖ ' + invite.guild.name + ' ‚òÖ     \n\n‚óù‚îà‚îà‚îà‚ãÜ‚îà‚îà‚ä∞‚ú©‚ä±‚îà‚îà‚ãÜ‚îà‚îà‚îà‚óú\n\n' + (invite.inviter ? invite.inviter.toString() : invite.guild.name) + ' **Te invita** <a:ositotikabella:880307057981542432> a disfrutar de la apertura de :tokyo_tower: *Babel*\n\n<:Awebo_a_simpiar:901600161875259452> *A por muchas <:Bolsitas_Midgard:978305556311838800> bolsitas y ese preciado <:hmorado_Midgard:978305606098255902> __Thanatos__*\n\n<a:Flecha3:880315279903703060> **Recuerda** que solo tienes <a:reloj:915171222961135646> **12 HORAS!!!!**')
    
                    message.reply({ content: '<@&960987738553868348>', embeds: [embed] }).catch((e) => console.log('Error al enviar mensaje: '+e))
                
                    setTimeout(() => {
                        
                        message.channel.send({ content: 'https://images-ext-2.discordapp.net/external/9iPHKFXXnKKSQpcFazlW79dr1zbbtdo7QT7-xxtfDY4/%3Fwidth%3D600%26height%3D86/https/media.discordapp.net/attachments/897951731462316073/915663567213199390/bar-1.gif?width=450&height=65' }).catch((e) => console.log('Error al enviar mensaje: '+e))
                     
                    }, 1000)

                }else {
    
                    return logschannel.send({ content: '<@753435606410985573> <@683501310527668228>\n```El link enviado por: ' + message.author.username + ' No pertenece a un servidor.```' }).catch((e) => console.log('Error al enviar mensaje: '+e))
    
                }
                   
            } catch (error) {
                
                if(error.message === 'Unknown Invite'){
    
                    return logschannel.send({ content: '<@753435606410985573> <@683501310527668228>\n```La API respondi√≥ que la invitaci√≥n enviada por ' + message.author.username + ' es Desconocida o No existe```' }).catch((e) => console.log('Error al enviar mensaje: '+e))
    
                } else{
                    
                    return logschannel.send({ content: '<@753435606410985573> <@683501310527668228>\n```Ocurri√≥ un error al intentar buscar informaci√≥n del link enviado por ' + message.author.username + '. \nError: ' + error + '```' }).catch((e) => console.log('Error al enviar mensaje: '+e))
                }
        
            }
            
        }


    }

    //& COMANDO ALIANZAS BABEL


    //% COMANDO BARRA GIF

    if(message.content.toLowerCase() === 'barra'){

        if(message.guild.id !== '777620055344545842') return
        
        let idadmins = ['753435606410985573','683501310527668228']
  
        if(!idadmins.some(id => message.author.id === id)) return 
        
        setTimeout(() => message.delete(), 100)
        
        message.channel.send('https://images-ext-2.discordapp.net/external/9iPHKFXXnKKSQpcFazlW79dr1zbbtdo7QT7-xxtfDY4/%3Fwidth%3D600%26height%3D86/https/media.discordapp.net/attachments/897951731462316073/915663567213199390/bar-1.gif?width=450&height=65').catch((e) => console.log('Error al enviar mensaje: '+e))
        
    }

    //% COMANDO BARRA GIF

    //& COMANDO CMEMBER UPDATE XP

    /*if(message.content.toLowerCase() === '!cmember'){
            
        if(message.channel.id !== '941504777056038922') return

        let fields, idxpclub, xpclub, indexid, indexxp, indexa, topchannel, userxp, subtotal, lista, dem, demxp, first, c, best, pos

        message.channel.sendTyping().then(async me => {
            
            let filter = a => a.author.id == '429457053791158281'

            const collector = message.channel.createMessageCollector({ filter, idle: 60000, max: 1 })
            
            collector.on('collect', async m => {
               
                try {
                    
                    fields = JSON.stringify(m.embeds, ['fields','value'], 2)

                    if(fields.includes(message.author.id)){

                        indexid = fields.indexOf(message.author.id)

                        idxpclub = fields.substring(indexid, indexid + 18)

                    }

                    if(fields.includes('**Experiencia:**')){

                        indexxp = fields.indexOf('**Experiencia:**')

                        indexa = fields.indexOf('**Aniversario:**')

                        xpclub = fields.substring(indexxp + 17, indexa - 2).replace(/,/g, '')

                    }

                    if(!xpclub || xpclub === undefined || xpclub === '' || xpclub === ' ' || parseInt(xpclub) < 0){

                        logschannel.send({ content: '```Error al detectar XP en el contenido del embed: ' + xpclub + '```' }).catch((e) => console.log('Error al enviar mensaje de logs: ' + e))

                        m.react('<a:Verify2:931463492677017650>').catch((e) => console.log('Error al reaccionar mensaje: '+e))

                        return

                    }

                } catch (error) {
                    
                    logschannel.send({ content: '```Ocurri√≥ un error al obtener datos del embed: ' + error + '```' }).catch((e) => console.log('Error al enviar mensaje de logs: ' + e))

                    m.react('<a:Verify2:931463492677017650>').catch((e) => console.log('Error al reaccionar mensaje: '+e))

                    return

                }
                
                topchannel = client.channels.cache.get('970094487059709953')

                try {

                    userxp = await xpclubSchema.findOne({ idusuario: idxpclub })
                
                    if(!userxp){
        
                        return

                    } else{
        
                        if(userxp.xpinicial > xpclub){
                         
                            logschannel.send({ content: '```El XP ingresado es menor que el XP inicial del participante: ' + idxpclub + '```' }).catch((e) => console.log('Error al enviar mensaje de logs: ' + e))

                            m.react('<a:Verify2:931463492677017650>').catch((e) => console.log('Error al reaccionar mensaje: '+e))

                            return
                            
                        }

                        subtotal = xpclub - userxp.xpinicial
        
                        console.log('========================= ACTUALIZACI√ìN DE XP CLUB =========================');
                                
                        let update = await xpclubSchema.findOneAndUpdate({idusuario: idxpclub},
                            {
        
                                xpfinal: xpclub,
                                xpsubtotal: subtotal,
                                xptotal: subtotal + userxp.xpadicional
        
                            })
        
                        update.save()
                        console.log('XP de Participante Registrado ===> Id: '+ idxpclub + ' - XP inicial: ' + userxp.xpinicial + ' - Total XP: ' + subtotal)
                         
                        console.log('========================= ACTUALIZACI√ìN DE XP CLUB =========================');
        
                        m.react('<a:cargando:887482093481902101>').catch((e) => console.log('Error al reaccionar mensaje: '+e))

                        try {
                    
                            lista = await xpclubSchema.find().sort({ xptotal: -1 })
                
                            dem = new Discord.MessageEmbed()
                            demxp = new Discord.MessageEmbed()
                
                            first = []
                
                            c = 1
                            pos = 0
                
                            var tablexp = new AsciiTable()
                            var tablexpm = new AsciiTable()
                            // tablexp.setHeading('**N¬∞**','**Participante**','**XP**','**Extra**','**TOTAL**')
                            // tablexp.setHeadingAlignCenter()
            
                            for(let ls of lista){
                
                                pos = pos + 1

                                if(c <= 10){
                                    
                                    tablexp.addRow('**' + c + '.**', '<@' + ls.idusuario + '>\n\n> *XP:* ' + ls.xpsubtotal + '  |  *Extra:* ' + ls.xpadicional + '\n> *TOTAL:* **' + ls.xptotal + '**\n\n')
                                    first.push(ls.idusuario)
                                    c = c + 1

                                }
                                
                                if(ls.idusuario === message.author.id){

                                    tablexpm.addRow('> <:flech:982579866358673448> ùöáùôø: ', '**' + ls.xpsubtotal + '**')
                                    tablexpm.addRow('> <:flech:982579866358673448> ùô∞ùöçùöíùöåùöíùöòùöóùöäùöï: ', '**' + ls.xpadicional + '**')
                                    tablexpm.addRow('> <:flech:982579866358673448> ùöÉùöòùöùùöäùöï: ', '**' + ls.xptotal + '**')
                                    tablexpm.setAlignLeft(0)
                                    tablexpm.setAlignRight(1)
                                    tablexpm.removeBorder()
                                    tablexpm.setJustify()
                                    demxp.setDescription('> <:estrellita:982579093365215252> ùôøùöòùöúùöíùöåùöíùöòÃÅùöó: **' + pos + '**\n> \n' + tablexpm.toString())

                                }
                        
                            }
                            
                            tablexp.setAlignCenter(0)
                            tablexp.setAlignCenter(1)
                            // tablexp.setAlignRight(2)
                            // tablexp.setAlignRight(3)
                            // tablexp.setAlignRight(4)
                            tablexp.removeBorder()

                            if(!lista){
    
                                logschannel.send({ content: '```No se encontr√≥ datos en la BD XP Club: ' + datos + '```' }).catch((e) => console.log('Error al enviar mensaje de logs: ' + e))
    
                                m.react('<a:Verify2:931463492677017650>').catch((e) => console.log('Error al reaccionar mensaje: '+e))
    
                                return
    
                            }
                
                            best = client.users.cache.get(first[0])
            
                            dem.setTitle('ùë¥ùíäùíÖùíàùíÇùíìùíÖ ùëøùë∑ ùëπùíÇùíÑùíÜ üíé')
                            dem.setThumbnail(best.displayAvatarURL() ? best.displayAvatarURL({dynamic: true, size: 2048}) : message.guild.iconURL({ dynamic: true, size: 2048 }))
                            dem.setImage('https://i.imgur.com/VKOLvQT.gif')
                            dem.setDescription(tablexp.toString())   	
                            dem.setColor("RANDOM")
                            dem.setTimestamp(new Date())
                            dem.setFooter({ text: 'ùêåùê¢ùêùùê†ùêöùê´ùêù ùêçùêûùê§ùê®ùêÇùê•ùêÆùêõ', iconURL: message.guild.iconURL() ? message.guild.iconURL({ dynamic: true, size: 2048 }) : 'https://i.imgur.com/MNWYvup.gif' })
            
                            demxp.setTitle('ùë¥ùíäùíÖùíàùíÇùíìùíÖ ùëøùë∑ ùëπùíÇùíÑùíÜ üíé')
                            demxp.setAuthor({ name: message.author.username+'#'+message.author.discriminator, iconURL: message.author.displayAvatarURL({ dynamic: true }) })
                            demxp.setColor("RANDOM")
                            demxp.setTimestamp(new Date())
                            demxp.setFooter({ text: 'ùêåùê¢ùêùùê†ùêöùê´ùêù ùêçùêûùê§ùê®ùêÇùê•ùêÆùêõ', iconURL: message.guild.iconURL() ? message.guild.iconURL({ dynamic: true, size: 2048 }) : 'https://i.imgur.com/MNWYvup.gif' })
            
                            setTimeout(() => {
                        
                                topchannel.bulkDelete(3).catch((e) => console.log('Error al eliminar mensajes: '+e))
                                topchannel.send('https://images-ext-2.discordapp.net/external/9iPHKFXXnKKSQpcFazlW79dr1zbbtdo7QT7-xxtfDY4/%3Fwidth%3D600%26height%3D86/https/media.discordapp.net/attachments/897951731462316073/915663567213199390/bar-1.gif?width=450&height=65').catch((e) => console.log('Error al enviar mensaje: '+e))
                                topchannel.send({ embeds: [dem] }).catch((e) => console.log('Error al enviar mensaje: '+e))
                                topchannel.send('https://images-ext-2.discordapp.net/external/9iPHKFXXnKKSQpcFazlW79dr1zbbtdo7QT7-xxtfDY4/%3Fwidth%3D600%26height%3D86/https/media.discordapp.net/attachments/897951731462316073/915663567213199390/bar-1.gif?width=450&height=65').catch((e) => console.log('Error al enviar mensaje: '+e))
            
                                m.reactions.removeAll().then(() => {

                                    m.react('<a:Verify1:931463354357276742>').catch((e) => console.log('Error al reaccionar mensaje: '+e))

                                }).catch((e) => console.log('Error al reaccionar mensaje: '+e))
    
                                message.reply({ allowedMentions: { repliedUser: false }, embeds: [demxp] }).catch((e) => console.log('Error al enviar mensaje: '+e))

                            }, 5000)
    
                            
                        } catch (error) {
                            
                            logschannel.send({ content: '```Ocurri√≥ un error al consultar Lista de BD XP CLub: ' + error + '```' }).catch((e) => console.log('Error al enviar mensaje de logs: ' + e))

                            m.react('<a:Verify2:931463492677017650>').catch((e) => console.log('Error al reaccionar mensaje: '+e))

                            return

                        }

                    }
                    
                } catch (error) {
        
                    logschannel.send({ content: '```Ocurri√≥ un error al actualizar Lista de BD XP CLub: ' + error + '```' }).catch((e) => console.log('Error al enviar mensaje de logs: ' + e))

                    m.react('<a:Verify2:931463492677017650>').catch((e) => console.log('Error al reaccionar mensaje: '+e))

                    return

                }

                
            })
            
            collector.on('end', async (collected, reason) => {
                
                if(collected.size < 1 || reason === 'time') return

            })
            
        }).catch((e) => {
            
            console.log('Error al enviar contenido del embed: ' + e)
            logschannel.send({ content: '```Error al detectar y enviar contenido del embed: ' + e + '```' }).catch((e) => console.log('Error al enviar mensaje de logs: ' + e))
        
        })

    }*/

    //& COMANDO CMEMBER UPDATE XP

    
    let bot = new RegExp(`^<@!?${'904290001196556369'}>( |)$`);
    
    if (message.content.match(bot))
    {
    
        const embed = new Discord.MessageEmbed()
        .setAuthor({ name: message.author.username+'#'+message.author.discriminator, iconURL: message.author.displayAvatarURL({ dynamic: true }) })
        .setDescription('Hola! **'+ message.author.username +'** Mi Prefix en  **' + message.guild.name + '**  es: `' + prefix + '`\nPuedes ver mis comandos disponibles usando: `' + prefix + 'help`. Para enviar un reporte usa: `' + prefix + 'report` y para una sugerencia: `' + prefix + 'suggestion`.')
        .setColor('RANDOM')
        message.reply({ allowedMentions: { repliedUser: false }, embeds: [embed] }).catch((e) => console.log('Error al enviar mensaje: '+e))
    
    }

    //var mencionbot = message.content.startsWith('mg') || message.content.startsWith('Mg') || message.content.startsWith('MG')
    //console.log(mencionbot+' mencion: '+client.user.id)

    if(!message.content.startsWith(prefix)) return; 
  
    const args = message.content.slice(prefix.length).trim().split(/ +/g)
    const command = args.shift().toLowerCase()
    //const prueba = message.content.split(' ')

    if(!command) return
    
    try {
        
        let userbl = await blSchema.findOne({idusuario: message.author.id})

        if(userbl)
        {

            console.log('Usuario en Lista Negra ===> Id: '+ message.author.id + ' Username: ' + message.author.username)
            
            const e = new Discord.MessageEmbed()
            .setAuthor({ name: message.author.username+'#'+message.author.discriminator, iconURL: message.author.displayAvatarURL({ dynamic: true }) })
            .setColor('RED')
            .setDescription('<a:Verify2:931463492677017650> | ¬°Est√°s prohibido de usar estos comandos!\n\n**Raz√≥n:**\n`'+userbl.reason+'`\n\nContacta con el equipo de desarrolladores para m√°s informaci√≥n.!')
          
            return message.channel.send({embeds: [e]}).catch((e) => console.log('Error al enviar mensaje: '+e))

        }

    } catch (error) {

        console.log('Error al buscar (comando) en la Tabla BL: '+ error)

    }

    let cmd = client.commands.get(command) ||
              client.commands.find((a) => a.aliases && a.aliases.includes(command)); // Obtiene el comando de la colecci√≥n client.commandos
  
    let canalcmd = client.channels.cache.get('965156845712994314')

    if(!cmd){

        let similares = []

        client.commands.map((comando) => {

            similares.push(comando.name)

        })

        const matches = Similar.findBestMatch(command, similares);

        similares = [];

        matches.ratings.map((rating) => {
            
            rating.rating > 0.5 ? similares.push(rating.target) : false;
                  
        });

        const e = new Discord.MessageEmbed()
        .setAuthor({ name: message.author.username+'#'+message.author.discriminator, iconURL: message.author.displayAvatarURL({ dynamic: true }) })
        .setColor('RED')
        .setDescription(`<a:Verify2:931463492677017650> | El comando **${command}** no existe!\n\n> Sugerencias: ${similares.map(s => `**${s}**`).join(' - ') || 'No tengo sugerencias'}`)
        
        return message.channel.send({embeds: [e]})
        .then(m => setTimeout(() => m.delete(), 15000))
        .catch((e) => console.log('Error al enviar mensaje: '+e))

    } else{

        if(cmd.owner == true){

            if(message.author.id != config.IdOwner){
                
                const e = new Discord.MessageEmbed()
                .setAuthor({ name: message.author.username+'#'+message.author.discriminator, iconURL: message.author.displayAvatarURL({ dynamic: true }) })
                .setColor('RED')
                .setDescription(`<a:Verify2:931463492677017650> | El comando **${command}** no existe!\n\n> Sugerencias: No tengo sugerencias`)
                
                return message.channel.send({embeds: [e]})
                .then(m => setTimeout(() => m.delete(), 15000))
                .catch((e) => console.log('Error al enviar mensaje: '+e))

            }

        }

        try {

            cmd.execute(client, message, args, Discord)

            let xyz = (message.content ? message.content : 'No se pudo obtener mensaje')

            if(xyz.length >= 1000){

                xyz = 'Contenido del comando demasiado largo.'

            }

            const embedcmd = new Discord.MessageEmbed()
            .setThumbnail(message.author.displayAvatarURL() ? message.author.displayAvatarURL({ dynamic: true , size: 2048 }).replace('webp','png') : client.user.avatarURL({ dynamic: true }))
            .setAuthor({ name: 'MidgardBot', iconURL: client.user.avatarURL({ dynamic: true}) })
            .setTitle('üì¢ | Comando Ejecutado: ' + (cmd ? cmd.name : 'No se pudo obtener comando'))
            .addField('\u200B','\u200B')
            .addField('Servidor: ', `<a:flech:931432469935312937> ${message.guild.name}`)
            .addField('Canal: ', `<a:flech:931432469935312937> <#${idcanal}>`)
            .addField('Autor: ', `<a:flech:931432469935312937> ${message.author}`)
            .addField('Comando: ', '> ' + xyz )
            .addField('\u200B','\u200B')
            .setColor('RANDOM')
            .setTimestamp(new Date())
            .setFooter({ text: `ID: ${message.author.id}`, iconURL: message.guild.iconURL() ? message.guild.iconURL({ dynamic: true }) : client.user.avatarURL({ dynamic: true }) })
            
            canalcmd.send({ embeds: [embedcmd] }).catch((e) => {
                
                console.log('Error al enviar mensaje: '+e)
                logschannel.send({ content: 'Error al enviar embed de comando ' + cmd.name + ' - ' + e })
            
            })

        } catch (error) {

            console.log('Error al ejecutar comando: '+error)
            logschannel.send({ content: 'Error al ejecutar comando ' + cmd.name + ' - ' + e })
          
        }

        //* Registro de Usuarios

        let userData;

        try {

            userData = await userModel.findOne({idusuario: message.author.id})

            if(!userData){

                console.log('========================= REGISTRO DE USUARIO =========================');
        
                let user = await userModel.create({

                    idusuario: message.author.id,
                    username: message.author.username,
    
                })
    
                user.save();
                console.log('Usuario Registrado ===> Id: '+ message.author.id + ' Username: ' + message.author.username)
   
                console.log('========================= REGISTRO DE USUARIO =========================');
   
            } else {

                //<-- UPDATE EXPERIENCIA/NIVELES -->
            
                console.log('========================= UPDATE EXPERIENCIA DE USUARIO =========================');
   
                let curLevel = Math.floor(0.1 * Math.sqrt(userData.exp + 1));

                if(curLevel > userData.nivel) {

                    let update = await userModel.findOneAndUpdate({idusuario: message.author.id},
                        {

                            exp: userData.exp + 1,
                            nivel: curLevel,
                            banco: userData.banco + (curLevel*1000),
                            total: userData.dinero + userData.banco + (curLevel*1000)

                        })

                    update.save()

                    console.log('Usuario: '+message.author.id+' ha subido al nivel: '+curLevel)
      
                }

                if(userData.vip === true) {

                    let update = await userModel.findOneAndUpdate({idusuario: message.author.id},
                        {
    
                            exp: userData.exp + 2
                            
                        })
    
                    update.save()

                } else if (userData.vip === false){

                    let update = await userModel.findOneAndUpdate({idusuario: message.author.id},
                        {
    
                            exp: userData.exp + 1
    
                        })
    
                    update.save()

                }

            }
   
        } catch (error) {

            console.log('Error al Registrar Usuario: '+ error)
    
        }
  
        //* Registro de Usuarios

    }
    
}